---
title: "Standings Tracker"
date: "Updated June 14, 2023"
output: 
  flexdashboard::flex_dashboard:
    social: [ "twitter", "facebook"]
    source_code: "https://github.com/joelrip/StandingsTracker"
    orientation: rows
    vertical_layout: fill
---

<style type="text/css">

.intro {  /* intro  */
   font-size: 16px;
   padding-left:10px;

</style>

<p class="intro">Graphing the progress of the 2023 US club soccer season, game by game.</p>

```{r setup, include=FALSE}
library(flexdashboard)
library(highcharter)

USLPointsLong = read.csv("USLPointsLong.csv", stringsAsFactors = F)

#Turn playoff thresholds into a list for graphing
thresholdsUSLW = list_parse2(USLPointsLong[which(USLPointsLong$Teams == "Thresholds" & USLPointsLong$Conference == "West"), c(2,10,11)])
thresholdBottomUSLW = list_parse2(USLPointsLong[which(USLPointsLong$Teams == "Thresholds" & USLPointsLong$Conference == "West"), c(2,10)])
for (item in 1:length(thresholdBottomUSLW)) {
  thresholdBottomUSLW[[item]][[3]] = -100
}

thresholdsUSLE = list_parse2(USLPointsLong[which(USLPointsLong$Teams == "Thresholds" & USLPointsLong$Conference == "East"), c(2,10,11)])
thresholdBottomUSLE = list_parse2(USLPointsLong[which(USLPointsLong$Teams == "Thresholds" & USLPointsLong$Conference == "East"), c(2,10)])
for (item in 1:length(thresholdBottomUSLE)) {
  thresholdBottomUSLE[[item]][[3]] = -100
}

#Turn PointsLessGames into a list for graphing
USLWestSeries = list()
for (item in unique(USLPointsLong$Teams[which(USLPointsLong$Teams != "Thresholds" & USLPointsLong$Conference == "West")])) {
  USLWestSeries = c(USLWestSeries, list(list(name = item,
                  data = USLPointsLong$PointsLessGames[which(USLPointsLong$Teams == item)],
                  marker = list(enabled = F))))
}

USLEastSeries = list()
for (item in unique(USLPointsLong$Teams[which(USLPointsLong$Teams != "Thresholds" & USLPointsLong$Conference == "East")])) {
  USLEastSeries = c(USLEastSeries, list(list(name = item,
                  data = USLPointsLong$PointsLessGames[which(USLPointsLong$Teams == item)],
                  marker = list(enabled = F))))
}


MLSPointsLong = read.csv("MLSPointsLong.csv", stringsAsFactors = F)

#Turn playoff thresholds into a list for graphing
thresholdsMLSW = list_parse2(MLSPointsLong[which(MLSPointsLong$Teams == "Thresholds" & MLSPointsLong$Conference == "West"), c(2,10,11)])
thresholdBottomMLSW = list_parse2(MLSPointsLong[which(MLSPointsLong$Teams == "Thresholds" & MLSPointsLong$Conference == "West"), c(2,10)])
for (item in 1:length(thresholdBottomMLSW)) {
  thresholdBottomMLSW[[item]][[3]] = -100
}

thresholdsMLSE = list_parse2(MLSPointsLong[which(MLSPointsLong$Teams == "Thresholds" & MLSPointsLong$Conference == "East"), c(2,10,11)])
thresholdBottomMLSE = list_parse2(MLSPointsLong[which(MLSPointsLong$Teams == "Thresholds" & MLSPointsLong$Conference == "East"), c(2,10)])
for (item in 1:length(thresholdBottomMLSE)) {
  thresholdBottomMLSE[[item]][[3]] = -100
}

#Turn PointsLessGames into a list for graphing
MLSWestSeries = list()
for (item in unique(MLSPointsLong$Teams[which(MLSPointsLong$Teams != "Thresholds" & MLSPointsLong$Conference == "West")])) {
  MLSWestSeries = c(MLSWestSeries, list(list(name = item,
                  data = MLSPointsLong$PointsLessGames[which(MLSPointsLong$Teams == item)],
                  marker = list(enabled = F))))
}

MLSEastSeries = list()
for (item in unique(MLSPointsLong$Teams[which(MLSPointsLong$Teams != "Thresholds" & MLSPointsLong$Conference == "East")])) {
  MLSEastSeries = c(MLSEastSeries, list(list(name = item,
                  data = MLSPointsLong$PointsLessGames[which(MLSPointsLong$Teams == item)],
                  marker = list(enabled = F))))
}

#cols = c("#e6194b", "#3cb44b", "#ffe119", "#0082c8", "#f58231", "#911eb4", "#46f0f0", "#f032e6",
#         "#d2f53c", "#fabebe", "#008080", "#800000", "#e6beff", "#eee9b7", "#aa6e28", "#aaffc3",
#         "#808000", "#000000")

###Assign team colors to all teams
cols = c("Atlanta United FC" = "#80000A",
         "Austin FC" = "#00B140",
         "Charlotte FC" = "#1A85C8",
         "Chicago Fire" = "#C2002F",
         "Colorado Rapids" = "#862633",
         "Columbus Crew" = "#FFF200",
         "DC United" = "#231F20",
         "FC Cincinnati" = "#F05323",
         "FC Dallas" = "#003E7E",
         "Houston Dynamo" = "#F4911E",
         "Inter Miami CF" = "#F7B5CD",
         "Los Angeles FC" = "#C39E6D",
         "Los Angeles Galaxy" = "#FFD200",
         "Minnesota United FC" = "#8CD2F4",
         "Montreal Impact" = "#2B63AD",
         "Nashville SC" = "#ECE83A",
         "New England Revolution" = "#E51938",
         "New York City FC" = "#6CACE4",
         "New York Red Bulls" = "#E31351",
         "Orlando City SC" = "#61259E",
         "Philadelphia Union" = "#002D55",
         "Portland Timbers" = "#00482B",
         "Real Salt Lake" = "#B30838",
         "San Jose Earthquakes" = "#221F1F",
         "Seattle Sounders FC" = "#658D1B",
         "Sporting Kansas City" = "#93B1D7",
         "St. Louis CITY SC" = "#E0004D",
         "Toronto FC" = "#AB1E2D",
         "Vancouver Whitecaps" = "#94C2E4",
         "Birmingham Legion FC" = "#9F8A59",
         "Charleston Battery" = "#FDCA00",
         "CS Switchbacks FC" = "#09305D",
         "Detroit City FC" = "#3F2021",
         "El Paso Locomotive FC" = "#73B3E6",
         "Hartford Athletic" = "#009845",
         "Indy Eleven" = "#CF1C2B",
         "Las Vegas Lights FC" = "#00BDEF",
         "Loudoun United FC" = "#000000",
         "Louisville City FC" = "#532B78",
         "Memphis 901 FC" = "#D31245",
         "Miami FC" = "#F03E1E",
         "Monterey Bay" = "#67D2DF",
         "New Mexico United" = "#FFF000",
         "Oakland Roots" = "#00BB7E",
         "Orange County SC" = "#EF3432",
         "Phoenix Rising" = "#EB1921",
         "Pittsburgh Riverhounds" = "#FFC629",
         "Rio Grande Valley FC Toros" = "#EE351E",
         "Sacramento Republic FC" = "#8B0F04",
         "San Antonio FC" = "#161113",
         "San Diego Loyal SC" = "#148F8C",
         "Tampa Bay Rowdies" = "#4A8B2C",
         "Tulsa Roughnecks" = "#BD9B60")
MLSWest = unique(MLSPointsLong$Teams[which(MLSPointsLong$Teams != "Thresholds" & MLSPointsLong$Conference == "West")])
MLSWestCols = unname(cols[grep(paste(MLSWest, collapse = "|"), names(cols))])
MLSEast = unique(MLSPointsLong$Teams[which(MLSPointsLong$Teams != "Thresholds" & MLSPointsLong$Conference == "East")])
MLSEastCols = unname(cols[grep(paste(MLSEast, collapse = "|"), names(cols))])
USLWest = unique(USLPointsLong$Teams[which(USLPointsLong$Teams != "Thresholds" & USLPointsLong$Conference == "West")])
USLWestCols = unname(cols[grep(paste(USLWest, collapse = "|"), names(cols))])
USLEast = unique(USLPointsLong$Teams[which(USLPointsLong$Teams != "Thresholds" & USLPointsLong$Conference == "East")])
USLEastCols = unname(cols[grep(paste(USLEast, collapse = "|"), names(cols))])

###Chart parameters
chartMax = 30
chartMin = -15
labelX = 34
labelYUp = 37
labelYDown = -14


```

MLS
===================================== 

Row
-----------------------------------------------------------------------

### <strong>MLS Western Conference</strong>

```{r}
highchart() %>%
  hc_add_series(name = "middle", type = "arearange", lineWidth = 0, showInLegend = F, color = "#f2f2f2",
                marker = list(enabled = FALSE), data = thresholdsMLSW, enableMouseTracking = F) %>%
  hc_add_series(name = "bottom", type = "arearange", lineWidth = 0, showInLegend = F, color = "#bbbbbb",
                marker = list(enabled = FALSE), data = thresholdBottomMLSW, enableMouseTracking = F) %>%
  hc_add_series_list(MLSWestSeries) %>%
  hc_colors(MLSWestCols) %>%
  hc_yAxis(title = list(text = "Points Minus Games Played"), 
           max = chartMax, min = chartMin, 
           endOnTick = F) %>%
  hc_xAxis(title = list(text = "Game")) %>%
  hc_annotations(
    list(
      labelOptions = list(x = 0, y = 0,
                          backgroundColor = "rgba(255, 255, 255, 0)",
                          borderColor = "rgba(255, 255, 255, 0)")
      # ,
      # labels = list(  #UNCOMMENT WHEN CLINCHED AND ELIMINATED AREAS APPEAR ON THE CHARTS
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYUp,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Clinched<br/>Playoffs"
      #   ),
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYDown,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Mathematically<br/>Eliminated"
      #   )
      #   )
      )) %>%
  hc_legend(align = "right", verticalAlign = "middle", layout = "vertical") %>%
  hc_tooltip(crosshairs = T, backgroundColor = "#fcffc5", shared = T,
             formatter = JS("function() {
                            var s = '<strong>Game '+ this.x +'</strong>';
                            
                            var sortedPoints = this.points.sort(function(a, b){
                            return ((a.y > b.y) ? -1 : ((a.y < b.y) ? 1 : 0));
                            });
                            $.each(sortedPoints , function(i, point) {
                            s += '<br/>'+ point.series.name +': '+ point.y;
                            });
                            
                            return s;
                            }")
                 )
```

### <strong>MLS Eastern Conference</strong>

```{r}
highchart() %>%
  hc_add_series(name = "middle", type = "arearange", lineWidth = 0, showInLegend = F, color = "#f2f2f2",
                marker = list(enabled = FALSE), data = thresholdsMLSE, enableMouseTracking = F) %>%
  hc_add_series(name = "bottom", type = "arearange", lineWidth = 0, showInLegend = F, color = "#bbbbbb",
                marker = list(enabled = FALSE), data = thresholdBottomMLSE, enableMouseTracking = F) %>%
  hc_add_series_list(MLSEastSeries) %>%
  hc_colors(MLSEastCols) %>%
  hc_yAxis(title = list(text = "Points Minus Games Played"), 
           max = chartMax, min = chartMin,
           endOnTick = F) %>%
  hc_xAxis(title = list(text = "Game")) %>%
  hc_annotations(
    list(
      labelOptions = list(x = 0, y = 0,
                          backgroundColor = "rgba(255, 255, 255, 0)",
                          borderColor = "rgba(255, 255, 255, 0)")
      # ,
      # labels = list(  #UNCOMMENT WHEN CLINCHED AND ELIMINATED AREAS APPEAR ON THE CHARTS
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYUp,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Clinched<br/>Playoffs"
      #   ),
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYDown,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Mathematically<br/>Eliminated"
      #   )
      #   )
      )) %>%
  hc_legend(align = "right", verticalAlign = "middle", layout = "vertical") %>%
  hc_tooltip(crosshairs = T, backgroundColor = "#fcffc5", shared = T,
             formatter = JS("function() {
                            var s = '<strong>Game '+ this.x +'</strong>';
                            
                            var sortedPoints = this.points.sort(function(a, b){
                            return ((a.y > b.y) ? -1 : ((a.y < b.y) ? 1 : 0));
                            });
                            $.each(sortedPoints , function(i, point) {
                            s += '<br/>'+ point.series.name +': '+ point.y;
                            });
                            
                            return s;
                            }")
                 )
```

USL Championship
===================================== 

Row
-----------------------------------------------------------------------

### <strong>USL Championship Western Conference</strong>

```{r}
highchart() %>%
  hc_add_series(name = "middle", type = "arearange", lineWidth = 0, showInLegend = F, color = "#f2f2f2",
                marker = list(enabled = FALSE), data = thresholdsUSLW, enableMouseTracking = F) %>%
  hc_add_series(name = "bottom", type = "arearange", lineWidth = 0, showInLegend = F, color = "#bbbbbb",
                marker = list(enabled = FALSE), data = thresholdBottomUSLW, enableMouseTracking = F) %>%
  hc_add_series_list(USLWestSeries) %>%
  hc_colors(USLWestCols) %>%
  hc_yAxis(title = list(text = "Points Minus Games Played"), 
           max = chartMax, min = chartMin,
           endOnTick = F) %>%
  hc_xAxis(title = list(text = "Game")) %>%
  hc_annotations(
    list(
      labelOptions = list(x = 0, y = 0,
                          backgroundColor = "rgba(255, 255, 255, 0)",
                          borderColor = "rgba(255, 255, 255, 0)")
      # ,
      # labels = list(  #UNCOMMENT WHEN CLINCHED AND ELIMINATED AREAS APPEAR ON THE CHARTS
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYUp,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Clinched<br/>Playoffs"
      #   ),
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYDown,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Mathematically<br/>Eliminated"
      #   )
      #   )
      )) %>%
  hc_legend(align = "right", verticalAlign = "middle", layout = "vertical") %>%
  hc_tooltip(crosshairs = T, backgroundColor = "#fcffc5", shared = T,
             formatter = JS("function() {
                            var s = '<strong>Game '+ this.x +'</strong>';
                            
                            var sortedPoints = this.points.sort(function(a, b){
                            return ((a.y > b.y) ? -1 : ((a.y < b.y) ? 1 : 0));
                            });
                            $.each(sortedPoints , function(i, point) {
                            s += '<br/>'+ point.series.name +': '+ point.y;
                            });
                            
                            return s;
                            }")
                 )
```

### <strong>USL Championship Eastern Conference</strong>

```{r}
highchart() %>%
  hc_add_series(name = "middle", type = "arearange", lineWidth = 0, showInLegend = F, color = "#f2f2f2",
                marker = list(enabled = FALSE), data = thresholdsUSLE, enableMouseTracking = F) %>%
  hc_add_series(name = "bottom", type = "arearange", lineWidth = 0, showInLegend = F, color = "#bbbbbb",
                marker = list(enabled = FALSE), data = thresholdBottomUSLE, enableMouseTracking = F) %>%
  hc_add_series_list(USLEastSeries) %>%
  hc_colors(USLEastCols) %>%
  hc_yAxis(title = list(text = "Points Minus Games Played"), 
           max = chartMax, min = chartMin, 
           endOnTick = F) %>%
  hc_xAxis(title = list(text = "Game")) %>%
  hc_annotations(
    list(
      labelOptions = list(x = 0, y = 0,
                          backgroundColor = "rgba(255, 255, 255, 0)",
                          borderColor = "rgba(255, 255, 255, 0)")
      # ,
      # labels = list(  #UNCOMMENT WHEN CLINCHED AND ELIMINATED AREAS APPEAR ON THE CHARTS
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYUp,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Clinched<br/>Playoffs"
      #   ),
      #   list(
      #     point = list(
      #       x = labelX,
      #       y = labelYDown,
      #       xAxis = 0,
      #       yAxis = 0
      #     ),
      #     text = "Mathematically<br/>Eliminated"
      #   )
      #   )
      )) %>%
  hc_legend(align = "right", verticalAlign = "middle", layout = "vertical") %>%
  hc_tooltip(crosshairs = T, backgroundColor = "#fcffc5", shared = T,
             formatter = JS("function() {
                            var s = '<strong>Game '+ this.x +'</strong>';
                            
                            var sortedPoints = this.points.sort(function(a, b){
                            return ((a.y > b.y) ? -1 : ((a.y < b.y) ? 1 : 0));
                            });
                            $.each(sortedPoints , function(i, point) {
                            s += '<br/>'+ point.series.name +': '+ point.y;
                            });
                            
                            return s;
                            }")
                 )
```

About
===================================== 
<p><strong>Welcome!</strong> I built this interactive chart of <a href="http://www.mlssoccer.com/">MLS</a> and <a href="http://www.uslsoccer.com/">USL Championship</a> standings after becoming frustrated with the fact that some teams had so many games in hand over other teams that the official standings became somewhat misleading. In the middle of the season, it's not uncommon for some teams to have played 5 or 6 more games than others as of a given date! It's less important how many points each team has on a given <strong>date</strong> than how many points they each have after playing a given number of <strong>games</strong>.

<p>So one thing these charts do is allow you to compare relative team standings after any given number of games. Just hover over a point in the charts, and you'll see the relative positions of all the teams when they had played that number of games. You can also remove a team from the chart by clicking its name in the legend, so you can see just the teams you want to see.

<p>But I have also made another, more experimental modification. Instead of showing the number of points each team has, the charts show the number of points <strong>minus the number of games played</strong>. Put another way, instead of 3 points for a win, 1 for a draw, and 0 for a loss, they show 2, 0, and -1 points respectively. This has the benefit of showing a team going <strong>down</strong> when they lose a game, staying level when they draw, and going up when they win, but without changing their relative positions. It's sort of like rotating the picture clockwise a bit. This way, if two teams have the same number of points, but one has played fewer games than the other, the team that has played fewer games is visually higher on the chart than the one that has played more games, giving what I think is a better representation of their relative positions in the standings. I hope you find it as useful as I do!